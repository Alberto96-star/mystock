{% extends "base.html" %}

{% block title %}Inventario{% endblock title %}

{% block content %}
<div class="container row justify-content-center mt-2">
    <nav class="navbar bg-secondary-subtle ancho-maximo mb-2 rounded-2">
        <div class="container-fluid d-flex flex-row justify-content-start">
            <form class="d-flex" role="search" method="GET">
                <select class="form-select me-2" name="buscarCategoria" onchange="this.form.submit()">
                    <option value="">Todas las categorías</option>
                    {% for cat in categorias %}
                    <option value="{{ cat.id }}" {% if cat.id|stringformat:"s" == categoria_seleccionada %}selected{% endif%}>
                        {{ cat.nombre_categoria }}
                    </option>
                    {% endfor %}
                </select>
                <input class="form-control me-2" type="search" name="buscarProducto" placeholder="Buscar producto"
                aria-label="Search" value="{{ request.GET.buscarProducto }}">
                <button class="btn btn-outline-teal" type="submit">Filtrar</button>
            </form>
                <a href="{% url 'lista_inventario' %}" class="btn btn-outline-secondary text-dark ms-2">
                    Limpiar filtro
                </a>
                <a class="btn btn-outline-teal ms-1" href="{% url 'crear_producto' %}">Crear producto</a>
        </div>
    </nav>

    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} ancho-maximo">{{ message }}</div>
    {% endfor %}
    {% endif %}

    <!-- Mostrar categoría actual si hay filtro aplicado -->
    {% if categoria_seleccionada %}
    <div class="alert alert-info ancho-maximo">
        Mostrando productos de la categoría:
        <strong>
            {% for cat in categorias %}
            {% if cat.id|stringformat:"s" == categoria_seleccionada %}
            {{ cat.nombre_categoria }}
            {% endif %}
            {% endfor %}
        </strong>
    </div>
    {% endif %}

    {% for producto in productos %}
    <ul class="list-group ancho-maximo mb-2 p-0">
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
                <strong>Código:</strong> {{producto.codigo_producto}} <br>
                <strong>Nombre:</strong> {{producto.nombre}} <br>
                <strong>Descripción:</strong> {{producto.descripcion}} <br>
                <strong>Precio Venta:</strong> ${{producto.precio_venta}} <br>
                <strong>Medidas:</strong> {{producto.unidad_medida}} <br>
                <strong>Categoría:</strong> <span>{{producto.categoria.nombre_categoria}}</span> <br>
                <strong>Cantidad Inventario:</strong> <span>{{producto.inventarios.first.cantidad_actual}} |</span>
                <strong>Cantidad Reservada:</strong> <span>{{producto.inventarios.first.cantidad_reservada}}</span> <br>
                <a class="btn btn-outline-teal btn-sm mt-2" href="{% url 'detalle_producto' producto.id %}">Modificar producto</a>
            </div>
        </li>
    </ul>

    {% empty %}
    <div class="alert alert-warning ancho-maximo">
        {% if categoria_seleccionada %}
        No hay productos en esta categoría.
        {% else %}
        No hay productos registrados.
        {% endif %}
    </div>
    {% endfor %}


</div>
{% endblock content %}